const serverAddress="wss://minesweeper-online.glitch.me/";let container,chunkloadlist=[];var dragOffset,dict,elementdict,biomes,count,animationdict,ubedict,nickname,flagcounter,ismobile,penalty,camerashakeorig,camerashakeover,docsc,mousePos,nickdiv,chatdiv,chatinput,chatbox,savetap,tapping,tapmove,doubletapcheck,mp,pid,namejson,viewinginfo,biomenames,commanddict,selectelement,tiledouble,renderfilter,dataat,animationobjects,mouseDown=[!1,!1,!1,!1,!1,!1,!1,!1,!1],ubeclouds=0,zoomMode=0;const sleep=t=>new Promise((e=>setTimeout(e,t)));function xmur3(t){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=(n=Math.imul(n^t.charCodeAt(e),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}async function reloadnames(){namejson=await fetch("/getstats"),namejson=(namejson=await namejson.json()).users}function changecoord(){if(2==document.getElementById("coordinput").value.replace(" ","").split(",").length){var t=document.getElementById("coordinput").value.replace(" ","").split(","),e=clamp(parseInt(t[0]),-1e3,1e3),n=clamp(parseInt(t[1]),-1e3,1e3);container.style.left=600*e,container.style.top=600*n,localStorage.setItem("prevpos",container.style.left+","+container.style.top)}}setInterval(cleardict,1e4);const clamp=(t,e,n)=>Math.min(Math.max(t,e),n);function spawnPlayerMarker(t,e,n,a,i){var o=document.getElementsByClassName("player");for(let t=0;t<o.length;t++)o[t].getAttribute("data-player")==a&&o[t].remove();if(1!=i){var r=document.createElement("div");r.setAttribute("class","player"),r.setAttribute("data-player",a),r.setAttribute("data-savecontainer","y"),r.style.left=50*t+"px",r.style.top=50*e+"px",r.style.filter="hue-rotate("+mod(360*mulberry32(xmur3(a)())()+180,360)+"deg)";var s=document.createElement("P");s.innerText=n,s.setAttribute("class","playertext"),r.appendChild(s),container.appendChild(r)}}function showInfo(t,e,n,a){viewinginfo==t+","+e?(a=!0,viewinginfo="n"):viewinginfo=t+","+e;var i=dict[t+","+e].split("_"),o=document.getElementsByClassName("info");for(let t=0;t<o.length;t++)o[t].remove();if(1!=a){var r=document.createElement("div");r.setAttribute("class","info"),r.setAttribute("data-savecontainer","y"),r.style.left=50*t+"px",r.style.top=50*e+"px";var s=document.createElement("P"),l="Unrevealed";1==i[1]&&("b"==(l=i[0])&&(l="Bomb"),"qb"==l&&(l="Misleading Bomb"),"ba"==l&&(l="Barrier"),"q"==l&&(l="Misled Tile")),2==i[1]&&(l="Flagged");var c=biomenames[i[2]];if(s.innerText="Position: X: "+t+", Y: "+e+"\nValue: "+l+"\nBiome: "+c,4==i.length){var m="Opened";2==i[1]&&(m="Flagged"),0!=i[1]&&(s.innerText="Position: X: "+t+", Y: "+e+"\nValue: "+l+"\nBiome: "+c+"\n"+m+" By: "+namejson[i[3]].nick)}s.setAttribute("class","infotext"),r.appendChild(s),container.appendChild(r)}}function selectinit(){var t=document.createElement("div");t.setAttribute("class","select"),t.setAttribute("id","select"),t.setAttribute("data-savecontainer","y"),t.style.left=50*Math.floor(parseFloat(container.style.left)/50)+"px",t.style.top=50*Math.floor(parseFloat(container.style.top)/50)+"px",container.appendChild(t),selectelement=document.getElementById("select")}function ismobilea(){return!!navigator.userAgent.match(/iphone|android|blackberry/gi)||!1}function mulberry32(t){return function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}function cleardict(){count=0}function preloadImages(){var t=[];n(animationdict.vanilla,",",".png"),n(animationdict.chocolate,",",".png"),n(animationdict.strawberry,",",".png"),n(animationdict.banana,",",".png"),n(animationdict.cookie,",",".png"),n(animationdict.cream,",",".png"),n(animationdict.creamcookie,",",".png"),n(animationdict.ube,",",".png"),n(animationdict.waffle,",",".png");for(let n=0;n<t.length;n++){var e=document.createElement("IMG");e.setAttribute("src",t[n]),e.setAttribute("style","display:none;"),e.setAttribute("alt",""),document.body.appendChild(e)}function n(e,n,a){var i=e.split(n);for(let e=0;e<i.length;e++)t.push(i[e]+a)}}function changenick(){localStorage.setItem("nick",document.getElementById("nickinput").value),nickname=document.getElementById("nickinput").value}async function setNick(){var t=await fetch("https://akabab.github.io/superhero-api/api/all.json");t=await t.json(),localStorage.setItem("nick",t[Math.floor(Math.random()*t.length)].name),nickname=localStorage.getItem("nick"),document.getElementById("nickinput").value=localStorage.getItem("nick"),t=new Object}var canopen,settingsstring;function addcss(t){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",t),document.getElementsByTagName("head")[0].appendChild(e)}function performCommand(t){var e=t.split(" ");commanddict.includes(e[0])?("players"==e[0]&&serverConnection.send(JSON.stringify({loadplayers:!0})),""!=e[0]&&"help"!=e[0]||(addChatMessage("List of commands:","","client"),addChatMessage("/players - shows a list of connected players.","","client"),addChatMessage("/settings - shows a list of settings","","client"),addChatMessage("/settings <setting> <mode> - sets a setting.","","client")),"zoom"==e[0]&&zoomOut(),"settings"==e[0]&&(1==e.length?(addChatMessage("List of settings:","","client"),addChatMessage('"rendermode" <fancy/performance> - Sets the render mode of chunks.',"","client"),addChatMessage('"filter" <sane/heavydrugs> - Sets the filter mode of the renderer.',"","client"),addChatMessage('"tilefilters" <off/on> - Visual filters such as the waffle tiles being darker/lighter.',"","client"),addChatMessage('"camerashake" <on/off> - The effect of the camera shaking when bombs are hit.',"","client")):("rendermode"==e[1]&&("performance"==e[2]?setSetting(0,1,"Render mode set to Performance."):setSetting(0,0,"Render mode set to Fancy.")),"filter"==e[1]&&("heavydrugs"==e[2]?(setSetting(1,1,"Filter set to Heavy Drugs."),renderfilter=1):(setSetting(1,0,"Filter set to Sane."),renderfilter=0)),"tilefilters"==e[1]&&("on"==e[2]?setSetting(2,1,"Tile Filters set to On."):setSetting(2,0,"Tile Filters set to Off.")),"camerashake"==e[1]&&("off"==e[2]?setSetting(3,1,"Camera Shake set to Off."):setSetting(3,0,"Camera Shake set to On."))))):addChatMessage("Command doesn't exist! do /help to see a list of commands.","","client")}function setSetting(t,e,n){addChatMessage(n,"","client");var a=localStorage.getItem("settings").split("");a[t]=e,localStorage.setItem("settings",a.join("")),settingsstring=a.join("")}function getSetting(t){return settingsstring.slice(t,t+1)}function init(){if(dataat=[],viewinginfo="n",null==localStorage.getItem("settings")&&localStorage.setItem("settings","00000000000000000000000000000000000000"),settingsstring=localStorage.getItem("settings"),commanddict=["help","","players","camerashake","zoom","settings"],chatinput=document.getElementById("chatinput"),document.title="Minesweeper Online",(docsc=document.getElementById("sct")).innerText=localStorage.getItem("sca"),docsc.style.color="#000000",ismobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(ismobile=!0),ismobile&&addcss("mobilestyle.css"),null==localStorage.getItem("nick")){setNick();var t=Math.floor(64e3*Math.random());localStorage.setItem("nick","Guest"+t)}if(nickname=localStorage.getItem("nick"),document.getElementById("nickinput").value=localStorage.getItem("nick"),count=0,biomes=["vanilla","chocolate","strawberry","banana","cookie","cream","creamcookie","ube","waffle"],biomenames=["Vanilla","Chocolate","Strawberry","Banana","Cookie Dough","Cookies & Cream","Cookies & Cream: Cookie","Ube","Waffle"],(animationdict=new Object).vanilla="https://imgur.com/WViACB7,https://imgur.com/Utnd1rY,https://imgur.com/dx3CQ9u,https://imgur.com/zHh3cMI,https://imgur.com/Vorvges,https://imgur.com/t9gSDcp,https://imgur.com/5R0Rw3N,https://imgur.com/RxllPUW",animationdict.chocolate="https://imgur.com/tbbi6VL,https://imgur.com/xi65uX2,https://imgur.com/ZNlpesw,https://imgur.com/zoJOS3K,https://imgur.com/7jK6exB,https://imgur.com/RxhNxbZ,https://imgur.com/zyz8K2N,https://imgur.com/zpEdvFV",animationdict.strawberry="https://imgur.com/JpDfMx3,https://imgur.com/SeHYCbM,https://imgur.com/BldAOEE,https://imgur.com/fC8e0Ok,https://imgur.com/EbOlA9S,https://imgur.com/MqSyilK,https://imgur.com/odE74Cr,https://imgur.com/wGfkdp5",animationdict.banana="https://imgur.com/5z5uJ4x,https://imgur.com/Cbor2G6,https://imgur.com/CeCXhle,https://imgur.com/DySUplm,https://imgur.com/eQPh72H,https://imgur.com/XDrDZpy,https://imgur.com/Mypb4hL,https://imgur.com/fvCOI0N",animationdict.cookie="https://imgur.com/OsmeaXI,https://imgur.com/mOoWQ6Z,https://imgur.com/wOKeX3c,https://imgur.com/hWl12p6,https://imgur.com/pqAKtYE,https://imgur.com/uo6Epeb,https://imgur.com/bGcCQS5,https://imgur.com/VB03sNC",animationdict.cream="https://imgur.com/sVxU2Ww,https://imgur.com/pzg2ZtG,https://imgur.com/SqHIVf0,https://imgur.com/l4dx5CN,https://imgur.com/ZQaFVbd,https://imgur.com/I58QtoN,https://imgur.com/juJ1eF1,https://imgur.com/54XUfNo",animationdict.creamcookie="https://imgur.com/IeQOWeJ,https://imgur.com/b1XbVxM,https://imgur.com/VKPwKfb,https://imgur.com/a6LGRLm,https://imgur.com/flKreTc,https://imgur.com/nlRsT99,https://imgur.com/jpS34YU,https://imgur.com/aBw97jl",animationdict.ube="https://imgur.com/JQaSiCD,https://imgur.com/oR7AmB6,https://imgur.com/egJc6ZY,https://imgur.com/Q8J0bRG,https://imgur.com/Sxlmwgh,https://imgur.com/8uLopCE,https://imgur.com/PbjyGSf,https://imgur.com/APzczdf",animationdict.waffle="https://imgur.com/rTZmqxa,https://imgur.com/HZ3rFJg,https://imgur.com/UhAIUGv,https://imgur.com/ARo1Xgk,https://imgur.com/PYSxWOo,https://imgur.com/RhQGloO,https://imgur.com/VFpMUZm,https://imgur.com/WHHJGty",dict=new Object,ubedict=[],elementdict=new Object,reloadnames(),container=document.getElementById("chunkcontainer"),container.style.left="0px",container.style.top="0px",null!=localStorage.getItem("prevpos")){var e=localStorage.getItem("prevpos").split(",");container.style.left=e[0],container.style.top=e[1]}document.getElementById("coordinput").value=Math.floor(parseInt(container.style.left)/600)+", "+Math.floor(parseInt(container.style.top)/600),document.body.onmousedown=function(t){canopen<1&&(canopen=1),mouseDown[t.button]=!0,0==t.button&&(dragOffset={x:t.clientX,y:t.clientY}),1==t.button&&(dragOffset={x:t.clientX,y:t.clientY},t.target,t.preventDefault(),t.stopPropagation())},document.body.onmouseup=function(t){mouseDown[t.button]=!1},document.body.onmousemove=function(t){mousePos={x:t.clientX,y:t.clientY},mp=mousePos,mouseDown[0]&&((canopen-=.05)<2&&(container.style.left=parseInt(container.style.left)+(t.clientX-dragOffset.x)+"px",container.style.top=parseInt(container.style.top)+(t.clientY-dragOffset.y)+"px",localStorage.setItem("prevpos",container.style.left+","+container.style.top),genLoop(),document.getElementById("coordinput").value=Math.floor(parseInt(container.style.left)/600)+", "+Math.floor(parseInt(container.style.top)/600)),dragOffset={x:t.clientX,y:t.clientY}),mouseDown[1]&&(container.style.left=parseInt(container.style.left)+(t.clientX-dragOffset.x)+"px",container.style.top=parseInt(container.style.top)+(t.clientY-dragOffset.y)+"px",localStorage.setItem("prevpos",container.style.left+","+container.style.top),genLoop(),document.getElementById("coordinput").value=Math.floor(parseInt(container.style.left)/600)+", "+Math.floor(parseInt(container.style.top)/600),dragOffset={x:t.clientX,y:t.clientY})},document.ontouchstart=function(t){dragOffset={x:t.clientX,y:t.clientY};var e=t.targetTouches[0];if(mp={x:e.pageX,y:e.pageY},t||(t=window.event),flagcounter=0,doubletapcheck>0){var n=raycastTile(mp.x,mp.y);if(tiledouble!=n.x+","+n.y)return tiledouble=n.x+","+n.y,void(doubletapcheck=17);tiledouble=n.x+","+n.y,showInfo((n=raycastTile(mp.x,mp.y)).x,n.y)}doubletapcheck=17},document.ontouchend=function(t){tapping=!1},document.ontouchmove=function(t){var e=t.targetTouches[0];mp={x:e.pageX,y:e.pageY},t||(t=window.event),container.style.left=parseInt(container.style.left)+(e.pageX-dragOffset.x)+"px",container.style.top=parseInt(container.style.top)+(e.pageY-dragOffset.y)+"px",localStorage.setItem("prevpos",container.style.left+","+container.style.top),genLoop(),document.getElementById("coordinput").value=Math.floor(parseInt(container.style.left)/600)+", "+Math.floor(parseInt(container.style.top)/600),tapping&&(tapmove+=1)>4&&(flagcounter=-99999),dragOffset={x:e.pageX,y:e.pageY}},document.body.onkeydown=function(t){if(13==t.keyCode&&(chatinput===document.activeElement?(""!=chatinput.value&&("/"==chatinput.value.slice(0,1)?performCommand(chatinput.value.slice(1,999)):sendChat(chatinput.value.slice(0,120))),chatinput.value="",chatinput.blur()):chatinput.focus()),72==t.keyCode&&null!=mp){if(chatinput===document.activeElement)return;var e=raycastTile(mp.x,mp.y);showInfo(e.x,e.y)}},preloadImages(),null!=localStorage.getItem("penalty")&&(penalty=parseInt(localStorage.getItem("penalty")),camerashakeover=0,camerashakeorig={x:0,y:0}),divInit(),setInterval(penaltyloop,25),renderfilter=getSetting(1),setInterval(scrollRainbow,10)}function openchatbox(){ismobile||(chatinput.focus(),mp={x:0,y:0})}function ping(){serverConnection.send(JSON.stringify({ping:!0}))}function raycastTile(t,e){return{x:Math.floor(t/50-parseFloat(container.style.left)/50),y:Math.floor(e/50-parseFloat(container.style.top)/50)}}function getTile(t){return dict[t].split("_")[0]}function getState(t){return dict[t].split("_")[1]}function getBiome(t){return dict[t].split("_")[2]}function getAuthor(t){return null!=dict[t].split("_")[3]?dict[t].split("_")[3]:-1}function changeStateDict(t,e){var n=dict[t].split("_");n[1]=e,dict[t]=n.join("_")}function changeAuthorDict(t,e){var n=dict[t].split("_");4==n.length?n[3]=e:n.push(e),dict[t]=n.join("_")}function generateChunk(t,e){var n=document.createElement("DIV");n.setAttribute("class","chunk"),n.setAttribute("data-chunk",t+","+e),n.setAttribute("data-dc",t/600+","+e/600),n.style.left=t+"px",n.style.top=e+"px",n.style.backgroundColor="#808080",container.appendChild(n),serverConnection.send(JSON.stringify({cx:t/600,cy:e/600})),count+=.2}var connected,serverConnection=new WebSocket(serverAddress);function addressIndex(t){var e=-1;for(let n=0;n<namejson.length;n++)if(namejson[n].address==t){e=n;break}return e}function holdtaptile(t,e){savetap=t,tapping=!0,tapmove=0}function holdtile(t,e){var n=t.getAttribute("data-id").split(",");canopen=0==getState(n)?999:0}function clicktile(t,e){if(penalty>0)1!=e.button&&(camerashakeover=20);else if(!ismobile){var n=e.button;flagcounter>200&&(n=2),0!=n&&(canopen=1);var a=t.getAttribute("data-id").split(","),i=0;0==n&&(i=1),2==n&&(i=2),1==i&&(opentile(t,!1,!0,4),serverConnection.send(JSON.stringify({x:parseInt(a[0]),y:parseInt(a[1]),state:i,player:nickname})),count+=1),2==i&&flagtile(t,parseInt(a[0]),parseInt(a[1]))}}function zoomOut(){var t=document.querySelector('meta[name="viewport"]');t&&(++zoomMode>2&&(zoomMode=0),1==zoomMode&&(t.content="initial-scale=0.5"),2==zoomMode&&(t.content="initial-scale=0.1"),0==zoomMode&&(t.content="initial-scale=1"))}function taptile(t,e){if(penalty>0)camerashakeover=20;else{if(!(flagcounter>40||flagcounter<-9999)){0;var n=t.getAttribute("data-id").split(","),a=0;1==(a=1)&&(opentile(t,!1,!0,4),serverConnection.send(JSON.stringify({x:parseInt(n[0]),y:parseInt(n[1]),state:a,player:nickname})),count+=1),2==a&&flagtile(t,parseInt(n[0]),parseInt(n[1]))}}}function flagtile(t,e,n){if(null!=t){var a=t.getAttribute("data-id");if(0==getState(a))changeStateDict(a,2),changeAuthorDict(a,pid),t.setAttribute("class","tile_flag_"+biomes[parseInt(t.getAttribute("data-biome"))]),serverConnection.send(JSON.stringify({x:e,y:n,state:2,player:nickname})),t.style.filter="none",count+=1;else if(2==getState(a)){if(changeStateDict(a,0),changeAuthorDict(a,pid),t.setAttribute("class","tile_unrevealed_"+biomes[parseInt(t.getAttribute("data-biome"))]),serverConnection.send(JSON.stringify({x:e,y:n,state:0,player:nickname})),"8"==t.getAttribute("data-biome")){var i=Math.floor(e/16),o=Math.floor(n/16),r=i;0==r&&(r=128);var s=o;0==s&&(s=67);var l=mulberry32(r*s*69*r*s+3*i+7*o)();"0"==getSetting(0)&&"1"==getSetting(2)&&(t.style.filter="brightness("+(Math.floor(50*(1-l))+50)+"%)")}if(0==t.getAttribute("data-biome")){var c=e;0==c&&(c=128);var m=n;0==m&&(m=67),(l=mulberry32(c*m*124*c*m+5*e+3*n)())>.999&&"0"==getTile(a)&&t.setAttribute("class","tile_sparkle_vanilla")}count+=1}}}function setflagtile(t,e,n){if(null!=t){var a=t.getAttribute("data-id");if(changeStateDict(a,e),changeAuthorDict(a,n),0==e){if(t.setAttribute("class","tile_unrevealed_"+biomes[parseInt(t.getAttribute("data-biome"))]),"8"==t.getAttribute("data-biome")){var i=a.split(","),o=Math.floor(parseInt(i[0])/16),r=Math.floor(parseInt(i[1])/16),s=o;0==s&&(s=128);var l=r;0==l&&(l=67);var c=mulberry32(s*l*69*s*l+3*o+7*r)();"0"==getSetting(0)&&"1"==getSetting(2)&&(t.style.filter="brightness("+(Math.floor(50*(1-c))+50)+"%)")}if(0==t.getAttribute("data-biome")){var m=parseInt(i[0]),u=parseInt(i[1]),p=m;0==p&&(p=128);var d=u;0==d&&(d=67),(c=mulberry32(p*d*124*p*d+5*m+3*u)())>.999&&"0"==getTile(a)&&t.setAttribute("class","tile_sparkle_vanilla")}}else t.setAttribute("class","tile_flag_"+biomes[parseInt(t.getAttribute("data-biome"))]),t.style.filter="none"}}async function chordtile(t,e,n){var a=t.getAttribute("data-id"),i=0;function o(t,e){var n=parseInt(a.split(",")[0])+t,i=parseInt(a.split(",")[1])+e;0==getState(n+","+i)&&(opentile(elementdict[n+","+i],!1,!0,4),serverConnection.send(JSON.stringify({x:n,y:i,state:1,chaining:!0,player:nickname})))}function r(t,e){var n=parseInt(a.split(",")[0]),o=parseInt(a.split(",")[1]),r=getState(n+t+","+(o+e)),s=getTile(n+t+","+(o+e));2!=r&&(1!=r||"b"!=s&&"qb"!=s)||i++}r(1,0),r(-1,0),r(0,1),r(0,-1),r(1,1),r(-1,-1),r(1,-1),r(-1,1),getTile(a)+""==i+""&&(o(1,0),o(-1,0),o(0,1),o(0,-1),o(1,1),o(-1,-1),o(1,-1),o(-1,1))}async function opentile(t,e,n,a,i,o){if(null!=t){var r=t.getAttribute("data-id");if(0==getState(r)){"b"!=getTile(r)&&"qb"!=getTile(r)||n&&(navigator.vibrate(1e3),camerashakeover=0,penalty=600,camerashakeorig={x:0,y:0});var s=document.createElement("DIV");s.setAttribute("class","tile_at_"+biomes[parseInt(t.getAttribute("data-biome"))]),s.setAttribute("data-at","0"),6==parseInt(t.getAttribute("data-biome"))&&(a*=2),s.setAttribute("data-ats",a),null!=i&&s.setAttribute("data-atsw",i),s.setAttribute("data-biome",biomes[parseInt(t.getAttribute("data-biome"))]),s.style.width="50px",s.style.height="50px",s.style.backgroundImage=animationdict[biomes[parseInt(t.getAttribute("data-biome"))]].split(",")[0],t.appendChild(s),dataat.push(s),t.setAttribute("class","tile_"+getTile(r)+"_"+biomes[parseInt(t.getAttribute("data-biome"))]),t.style.filter="none",changeStateDict(r,1),n&&(o=pid),changeAuthorDict(r,o);var l=parseInt(r.split(",")[0]),c=parseInt(r.split(",")[1]);if("0"==getTile(r)&&(e||chain(l,c)),n){var m=10;e&&(m=1),"b"!=getTile(r)&&"qb"!=getTile(r)||(m=-1e3);var u=parseInt(localStorage.getItem("sca"));null==localStorage.getItem("sca")&&(u=0);var p=u+m;localStorage.setItem("sca",p),docsc.innerText=p,docsc.style.color=m>0?"#2DFF2D":"#FF303E"}}else chordtile(t,e,n)}}function setopentile(t){var e=t.getAttribute("data-id");t.setAttribute("class","tile_"+getTile(e))}async function chain(t,e){for(var n=[t+","+e],a={x:t,y:e};;){var i=n[0];if(o(1,0),o(-1,0),o(0,1),o(0,-1),o(1,1),o(-1,-1),o(-1,1),o(1,-1),n.shift(),0==n.length)break;0}function o(t,e){var o=i.split(","),r=t+parseInt(o[0]),s=e+parseInt(o[1]);0==getState(r+","+s)&&("0"==getTile(r+","+s)&&(n.includes(r+","+s)||n.push(r+","+s)),opentile(elementdict[r+","+s],!0,!0,5,Math.floor(5*getDistance(r,s,a.x,a.y))))}}function getDistance(t,e,n,a){var i=t-n,o=e-a;return Math.sqrt(i*i+o*o)}function penaltyloop(){if(penalty>0){var t;penalty-=1,localStorage.setItem("penalty",penalty),camerashakeover>0&&(camerashakeover-=.2),t=penalty>2500?(penalty-2500)/40+2+camerashakeover:2+camerashakeover,"1"==getSetting(3)&&(t=0);var e={x:Math.floor(2*(Math.random()-.5)*t),y:Math.floor(2*(Math.random()-.5)*t)};container.style.left=parseInt(container.style.left)+-1*camerashakeorig.x+e.x,container.style.top=parseInt(container.style.top)+-1*camerashakeorig.y+e.y,camerashakeorig={x:e.x,y:e.y}}}function componentToHex(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function rgbToHex(t,e,n){return"#"+componentToHex(t)+componentToHex(e)+componentToHex(n)}function hexToRgb(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}serverConnection.onopen=function(){setInterval(loop,5),setInterval(ping,1e4),connected=!0},serverConnection.onclose=function(){location.reload(),connected=!1},serverConnection.onmessage=function(t){if(validJson(t.data)){var e=JSON.parse(t.data);if(null!=e.chunkdata){var n=e.chunkx+","+e.chunky,a=document.getElementsByClassName("chunk");for(let t=0;t<a.length;t++){if(a[t].getAttribute("data-dc")==n){var i=a[t],o=chunkdecompress(e.chunkdata,e.chunkx,e.chunky).split("*"),r=0,s=parseInt(getSetting(0)),l=getSetting(2);for(let t=0;t<12;t++)for(let n=0;n<12;n++){var c=12*e.chunkx+n,m=12*e.chunky+t,u=o[r].split("_"),p="unrevealed";1==parseInt(u[2])&&(p=u[1]),2==parseInt(u[2])&&(p="flag");var d=document.createElement("DIV");if(d.setAttribute("class","tile_"+p+"_"+biomes[parseInt(u[3])]),d.setAttribute("id",c+","+m),d.setAttribute("data-id",u[0]),d.setAttribute("data-biome",u[3]),d.setAttribute("onmouseup","clicktile(this, event)"),d.setAttribute("ontouchend","taptile(this, event)"),d.setAttribute("ontouchstart","holdtaptile(this, event)"),d.setAttribute("onmousedown","holdtile(this, event)"),i.appendChild(d),dict[c+","+m]=u.slice(1,99).join("_"),"8"==u[3]){var g=Math.floor(c/16),h=Math.floor(m/16),f=g;0==f&&(f=128);var y=h;0==y&&(y=67);var b=mulberry32(f*y*69*f*y+3*g+7*h)();c%16!=0&&m%16!=0&&"0"==u[2]&&0==s&&"1"==l&&(d.style.filter="brightness("+(Math.floor(50*(1-b))+50)+"%)")}if("0"==u[3]||"8"==u[3]){var v=c;0==v&&(v=128);var k=m;0==k&&(k=67);b=mulberry32(v*k*124*v*k+5*c+3*m)();var I=.999;"8"==u[3]&&(I=.99),b>I&&"0"==u[1]&&"0"==u[2]&&d.setAttribute("class","tile_sparkle_"+biomes[parseInt(u[3])])}elementdict[c+","+m]=d,r++}}}}else if(null!=e.state&&null!=e.x&&null!=e.y){var x=addressIndex(e.playerauth);1==e.state&&(opentile(elementdict[e.x+","+e.y],!1,!1,4,0,x),spawnPlayerMarker(e.x,e.y,e.player,e.playerauth,!1)),0!=e.state&&2!=e.state||(setflagtile(elementdict[e.x+","+e.y],e.state),spawnPlayerMarker(e.x,e.y,e.player,e.playerauth,!1))}else if(null!=e.message&&null!=e.player&&null!=e.playerauth)addChatMessage(e.message,e.player,e.playerauth);else if(null!=e.chatlog){var w=e.chatlog.length;for(let t=0;t<w;t++){addChatMessage((A=e.chatlog[t]).message,A.player,A.playerauth)}}else if(null!=e.playerslist){w=e.playerslist.length;addChatMessage(": List of online players","","client");for(let t=0;t<w;t++){var A;addChatMessage("-"+(A=e.playerslist[t]),"","client")}}else null!=e.setpid?pid=e.setpid:null!=e.reloadnames&&reloadnames()}};const lerp=(t,e,n)=>t*(1-n)+e*n,invlerp=(t,e,n)=>clamp((n-t)/(e-t)),range=(t,e,n,a,i)=>lerp(n,a,invlerp(t,e,i));function genLoop(){var t=[];const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var a=Math.floor(e/600),i=Math.floor(n/600),o=Math.floor(parseInt(container.style.left)/600),r=Math.floor(parseInt(container.style.top)/600);if(penalty>0)o=Math.floor((parseInt(container.style.left)+-1*camerashakeorig.x)/600),r=Math.floor((parseInt(container.style.top)+-1*camerashakeorig.y)/600);var s=parseInt(getSetting(0));for(let e=1*s-2;e<a+1;e++)for(let n=1*s-2;n<i+1;n++){var l=600*(-1*o+e),c=600*(-1*r+n);chunkloadlist.includes(l+","+c)||(chunkloadlist.push(l+","+c),generateChunk(l,c)),t.push(l+","+c)}var m=chunkloadlist.length,u=chunkloadlist;for(let e=0;e<m;e++)if(!t.includes(u[e])){var p=container.childElementCount,d=container.childNodes;for(let t=1;t<p+1;t++){var g=d[t];if(null==g)break;if("y"!=g.getAttribute("data-savecontainer"))g.getAttribute("data-chunk")==chunkloadlist[e]&&(deleteDictElements(g.getAttribute("data-dc")),container.removeChild(g),chunkloadlist.splice(e,1))}}var h=dataat;for(let t=0;t<h.length;t++)if(void 0!==h[t]&&null!=h[t]){var f=parseFloat(h[t].style.opacity)-.002;h[t].style.opacity=""+f,f<=0&&h[t].remove();var y=animationdict[h[t].getAttribute("data-biome")].split(",")[Math.floor(parseInt(h[t].getAttribute("data-at"))/parseInt(h[t].getAttribute("data-ats")))]+".png";h[t].style.backgroundImage="url('"+y+"')";var b=1;null!=h[t].getAttribute("data-atsw")&&parseInt(h[t].getAttribute("data-atsw"))>0&&(b=0,h[t].setAttribute("data-atsw",parseInt(h[t].getAttribute("data-atsw"))-1)),h[t].setAttribute("data-at",parseInt(h[t].getAttribute("data-at"))+b),parseInt(h[t].getAttribute("data-at"))>=8*parseInt(h[t].getAttribute("data-ats"))-1&&(h[t].remove(),dataat.splice(t,1))}}function loop(){if((t=(t=docsc.style.color).substring(4,t.length-1).replace(/ /g,"").split(","))[0]>5&&t[1]>5&&t[2]>5){var t={r:t[0],g:t[1],b:t[2]},e={r:lerp(t.r,0,.01),g:lerp(t.g,0,.01),b:lerp(t.b,0,.01)};docsc.style.color="rgb("+e.r+","+e.g+","+e.b+")"}else docsc.style.color="rgb(0,0,0)";if(doubletapcheck-=.5,ismobile&&tapping&&++flagcounter>20){var n=savetap.getAttribute("data-id").split(",");1!=getState(n)&&navigator.vibrate(100),flagtile(savetap,parseInt(n[0]),parseInt(n[1])),flagcounter=-99999}count>75&&(alert("Error: You're being ratelimited."),count=-1e3),divLoop(),genLoop(),cloudLoop()}var nickinputel,coordinputel;function divInit(){nickdiv=document.getElementById("nickdiv"),chatdiv=document.getElementById("chatdiv"),chatbox=document.getElementById("chatbox"),nickinputel=document.getElementById("nickinput"),coordinputel=document.getElementById("coordinput"),nickdiv.style.backgroundColor="rgba(255, 255, 255, 0.99)",chatdiv.style.backgroundColor="rgba(255, 255, 255, 0.99)"}function divLoop(){if(null==mousePos||null==chatinput)return;const t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var n=1;function a(t,e){var n=t.style.backgroundColor;n=n.replace("rgba(","").replace(")","").replace(" ","").split(","),t.style.backgroundColor="rgba(255, 255, 255, "+clamp(parseFloat(n[3])+e,0,.9)+")"}ismobile&&(n=.5),mousePos.x>t-300*n&&mousePos.y<350*n||document.activeElement===nickinputel||document.activeElement===coordinputel?a(nickdiv,.05):a(nickdiv,-.05),mousePos.x<400*n&&mousePos.y>e-450*n||chatinput===document.activeElement?a(chatdiv,.05):a(chatdiv,-.05)}function sendChat(t){serverConnection.send(JSON.stringify({message:t,player:nickname})),addChatMessage(t,nickname,"n")}function addChatMessage(t,e,n){if("server"!=n||t!=nickname+" has joined."&&t!=nickname+" has left."){var a=document.createElement("p");a.setAttribute("class","chatmessage"),a.innerText=e+": "+t,"server"!=n&&"client"!=n||(a.innerText=t),chatbox.appendChild(a),chatbox.scrollTop=chatbox.scrollHeight,chatbox.childElementCount>100&&chatbox.firstChild.remove()}}function deleteDictElements(t){if(null!=t&&null!=t){var e=t.split(","),n=parseInt(e[0]),a=parseInt(e[1]);for(let t=0;t<12;t++)for(let e=0;e<12;e++){var i=12*n+e,o=12*a+t;delete dict[i+","+o],delete elementdict[i+","+o]}}}function getMousePos(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function validJson(t){try{JSON.parse(t)}catch(t){return!1}return!0}function cloudLoop(){}function mod(t,e){return(t%e+e)%e}function selectloop(){var t=raycastTile(mp.x,mp.y);selectelement.style.left=lerp(parseFloat(selectelement.style.left),50*t.x,.25),selectelement.style.top=lerp(parseFloat(selectelement.style.top),50*t.y,.25)}var rainbowoffset=0;function scrollRainbow(){1==renderfilter&&(rainbowoffset+=10,document.querySelectorAll("[data-id]").forEach((async function(t){var e=t.getAttribute("data-id").split(",");t.style.filter="hue-rotate("+Math.floor(mod(10*parseInt(e[0])+rainbowoffset,360))+"deg)"})))}var ascii="!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}\"",tilevalues=["0","1","2","3","4","5","6","7","8","9","b","ba","qb","q"];function weirdhex(t){var e=ascii.length;return ascii[Math.floor(t/(e-1))]+ascii[t%(e-1)]}function weirdunhex(t){var e=ascii.length;return ascii.indexOf(t[0])*(e-1)+ascii.indexOf(t[1])}function chunkcompress(t){var e=[],n=t.split("*");for(const t in n){var a=n[t].split("_"),i=parseInt(a[2])+3*parseInt(a[3]),o="~";a.length>4&&(o=weirdhex(parseInt(a[4])));var r=ascii[tilevalues.indexOf(a[1])]+ascii[i]+o;e.push(r)}return e.join("")}function chunkldecompress(t,e){return chunkdecompress(t,parseInt(e.split(",")[0]),parseInt(e.split(",")[1]))}function chunkdecompress(t,e,n){var a=t.split(""),i="",o=0,r=[],s=0;for(const t in a){var l=a[t];i+=l;var c=!1;if((++o%4==0||"~"==l)&&(c=!0),c){var m=ascii.indexOf(i[0]),u=ascii.indexOf(i[1]),p=tilevalues[m],d=u%3,g=Math.floor(u/3),h=12*e+s%12+","+(12*n+Math.floor(s/12))+"_"+p+"_"+d+"_"+g;i.length>3&&(h+="_"+weirdunhex(i[2]+i[3])),r.push(h),o=0,i="",s++}}return r.join("*")}